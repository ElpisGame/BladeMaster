# ERC20

-   `approve(address spender, uint256 amount)`

Set the amount of token `amount` allowed to be spent by `spender`.

# Elpis: Origin Asset

The NFT tokens in Elpis: Origin are derived from ERC721A. Common ERC721 APIs can be found at: https://docs.openzeppelin.com/contracts/4.x/erc721.

### Functions

-   `mintAsset(address _to) onlyOwner`

Mint `_amount` number of assets and transfer them to address `to`. Server needs to keep track of the tokenId and generate the corresponding metadata file.

-   `totalSupply() view returns (uint256)`

Return total number of token minted with token id `id`.

-   `balanceOf(address account, uint256 id) view returns (uint256)`

Return the amount of token owned by `account` with token id `id`.

-   `tokenURI(uint256 tokenId) view returns (string memory)`

Returns the link to the metadata of the `tokenId` token.

# Elpis: Origin Marketplace

Elpis: Origin provides a marketplace for users to trade their in-game assets using Elpis: Origin Token.

### Functions

-   `setup(address _token, uint256 _tokenId, uint256 _price) returns (uint256)`

Allow user to list their asset for sale, return the id recorded for this sale.

`_token`: the Elpis: Origin Asset token address;

`_tokenId`: the token id the user wishes to list for sale;

`_price`: the number of the token the user wishes to sale for.

-   `trade(uint256 _saleId)`

Purchase the listed asset with the id of `_saleId`.

-   `claim(uint256 _saleId)`

After a successful sale, the seller will be able to claim the token the buyer paid for the asset with the id of `_saleId`.

# Elpis: Origin Vault

Vault is responsible for in-game NFT/token storing/purchasing.

```solidity
struct  SaleInfo {
	address nftAddress;
	uint256 nftId;
	address tokenAddress;
	uint256 amount;
}
```

### Public variables

`address pocket`: address for recieving money.

`uint256 saleInfoId`: next assigning sale ID.

### Functions

-   `setupSale(address _nftaddress, uint256 _nftId, address _token, uint256 _amount) onlyOwner`

emit `SaleSetup(saleInfoId, _nftAddress, _nftId, _token, _amount)`

Setup the sale price for each un-initalized NFT stored in the contract.

`_nftaddress`: NFT contract address;

`_nftId`: NFT corresponding token id;

`_token`: token address used for payment;

`_amount`: price;

`saleInfoId`: an ID assigned to this NFT's `SaleInfo`.

-   `distributeAsset(address  _newOwner, address  _nftaddress, uint256  _nftId) onlyOwner`

emit `DistributeAsset(_newOwner, _nftAddress, _nftId)`

Set the owner of a not owned NFT to a user, later the user can unlock the NFT itself.

`_newOwner`: the owner of this NFT.

`_nftaddress`: NFT contract address;

`_nftId`: NFT corresponding token id.

-   `pay(uint256 _saleId)`

emit `Pay(_saleId, nftAddress, nftId, tokenAddress, amount, payerAddress)`

Payment for certain item.

`_saleId`: an id used for certain `SaleInfo`:

`nftAddress`: NFT contract address;

`nftId`: NFT token id;

`tokenAddress`: payment token address;

`amount`: listed price;

`payerAddress`: user who purchased the NFT.

-   `payWithSig(address _nftaddress, uint256 _nftId, address _token, uint256 _amount, bytes _signature)`

emit `PayWithSig(msg.sender, _nftAddress, _nftId, _tokenAddress, _amount)`

Payment for certain item.

`_nftAddress`: NFT contract address;

`_nftId`: NFT token id;

`_tokenAddress`: payment token address;

`_amount`: listed price;

`_signature`: signature generated by the vault admin.

-   `lockToken(address _token, uint256 _amount)`

emit `LockToken(msg.sender, _token, _amount)`

Import token to game.

`_token`: token contract address;

`_amount`: the amount of token.

-   `unlockToken(address _token, uint256 _amount)`

emit `UnlockToken(msg.sender, _token, _amount)`

Export token to wallet which imported the token, can only be called by the token owner.

`_token`: NFT contract address;

`_amount`: the amount of token.

-   `lockAsset(address _nftAddress, uint256 _nftId)`

emit `LockAsset(msg.sender, _nftAddress, _nftId)`

Import NFT to game.

`_nftAddress`: NFT contract address;

`_nftId`: NFT corresponding token id.

-   `unlockAsset(address _nftAddress, uint256 _nftId)`

emit `UnlockAsset(msg.sender, _nftAddress, _nftId)`

Export NFT to wallet which imported the NFT, can only be called by the NFT owner.

`_nftAddress`: NFT contract address;

`_nftId`: NFT corresponding token id.



## NFT lifecycle:

https://miro.com/welcomeonboard/MjBRa3M4ekt3N29KZjMzNllUZmJsQjQzMXZYVGFwODVFUldhSTVHVUxFU0dnZ3FwTFI1TnRaRVB4OG8yd0VYYXwzNDU4NzY0NTU3OTA2OTkwNDEyfDI=?share_link_id=770583179389

## Purchase flowchart:

https://miro.com/welcomeonboard/aWViVmpEczlodlltVTg2aFpWVTN3V0xXdG5ZR3o1RndyTWJudlZCRmVwWFdEVUQ5ZEtzQ3Q0c0FqRktlcnZFM3wzNDU4NzY0NTU3OTA2OTkwNDEyfDI=?share_link_id=832261829043
